!function(a,b){"use strict";return"function"==typeof define&&define.amd?void define(["jquery"],function(c){return b(a,c,!1)}):void b(a,a.jQuery||a.Zepto||a.ender||a.$,!0)}(this,function(a,b,c){"use strict";var d;return d={options:{timeout:null,meter:b(".scroolly"),body:document},theCSSPrefix:"",theDashedCSSPrefix:"",isMobile:!1,isInitialized:!1,animFrame:null,direction:0,scrollTop:0,scrollCenter:0,scrollBottom:0,docHeight:0,docMiddle:0,winHeight:b(window).height()},d.scrollLayout={},d._isObject=function(a){return"object"==typeof a},d._isArray=function(a){return a instanceof Array},d._isNumber=function(a){return a instanceof Number||"number"==typeof a},d._isString=function(a){return a instanceof String||"string"==typeof a},d._default=function(a,b,c){void 0===c&&(c=null);var e=(b+"").split(".");if(a&&(d._isObject(a)||d._isArray(a))){var g,f=a;for(var h in e){if(g=e[h],!d._isObject(f)&&!d._isArray(f)||void 0===f[g])return c;f=f[g]}return f}return c},d.parseCoords=function(a){var b=a.split(/\s*=\s*/),c=b[0]||"doc-top",e=d.parseCoord(c),f=b[1]||e.anchor,g=d.parseCoord(f);return[e,g]},d.parseCoord=function(a){var b=/((vp|doc|el|con)-)?(top|center|bottom)?/i,c="(\\+|-)?\\s*(\\d+)(\\%|vp|doc|el|con)?",d=new RegExp(c,"gi"),e=a.match(b),f=a.match(d);if(!e&&!f)return!1;var g=e[1]?e[2]:"vp",h=e[3]||"top",i=[];if(f){d=new RegExp(c,"i");for(var j,k,l,m,n,o=0;o<f.length;o++)j=f[o],k=j.match(d),l=k[1]&&"-"===k[1]?-1:1,m=k[2]&&parseInt(k[2])*l||0,n="px",k[3]&&(n="%"===k[3]?g:k[3]),i.push({offset:m,subject:n})}return{original:a,subject:g,anchor:h,offsets:i}},d.calculateCoord=function(a,b,c){d._isString(a)&&(a=d.parseCoord(a));var e=0;if("vp"===a.subject)switch(a.anchor){case"top":e=d.scrollTop;break;case"center":e=d.scrollCenter;break;case"bottom":e=d.scrollBottom}else if("doc"===a.subject)switch(a.anchor){case"top":e=0;break;case"center":e=d.docMiddle;break;case"bottom":e=d.docHeight}else{var f="con"===a.subject?c:b,g=f.outerHeight(),h=f.offset().top,i=h+g,j=h+Math.floor(g/2);switch(a.anchor){case"top":e=h;break;case"center":e=j;break;case"bottom":e=i}}var k,l,m,n;for(k=0;k<a.offsets.length;k++){if(l=a.offsets[k],m=l.offset,"px"!==l.subject){switch(n=0,l.subject){case"vp":n=d.winHeight;break;case"doc":n=d.docHeight;break;case"el":n=b.outerHeight();break;case"con":n=c.outerHeight()}m=Math.ceil(l.offset/100*n)}e+=m}return e},d.cmpCoords=function(a,b,c){return d.calculateCoord(a[0],b,c)-d.calculateCoord(a[1],b,c)},d.isRuleInActiveWidthRange=function(a){var h,i,j,c=d._default(a,"minWidth",0),e=d._default(a,"maxWidth","infinity"),f=d._default(d.options,"meter"),g=b(window).width();return f.length?(h=f.length?parseInt(f.css("min-width")):0,i=f.length?f.css("max-width"):"none",i="none"===i?"infinity":parseInt(i),j=h>=c&&("infinity"===e||e>=i)):g>c&&("infinity"===e||e>=g)},d.isRuleActive=function(a,b,c){var e=d.isRuleInActiveWidthRange(a);if(!e)return!1;var f=d._default(a,"direction",0),g=d.direction;if(f&&(f>0&&0>g||0>f&&g>=0))return!1;var h=d._default(a,"from","0"),i=d._default(a,"to","finish"),j=d.cmpCoords(h,b,c);if(j>0)return!1;var k=d.cmpCoords(i,b,c);return 0>=k?!1:{offset:-j,length:k-j}},d.getScrollLayoutLength=function(){return Object.keys?Object.keys(d.scrollLayout).length:b.map(d.scrollLayout,function(){return 1}).length},d.addItem=function(a,c,e,f){if(!c.length)return!1;f=f||"self";var g,h,i,j,k,l,m;m=function(a,b,c,e){var j,k,f=b/c,g=d._default(e,"cssFrom"),h=d._default(e,"cssTo"),i={};for(var l in g)j=g[l],k=d._default(h,l,j),i[l]=d.getTransitionValue(j,k,f);a.css(d.extendCssWithPrefix(i))};for(var n in e)g=e[n],h=!f,i=d._default(g,"from","doc-top"),(d._isString(i)||d._isNumber(i))&&(i=d.parseCoords(""+i),g.from=i),j=d._default(g,"to","doc-bottom"),(d._isString(j)||d._isNumber(j))&&(j=d.parseCoords(""+j),g.to=j),k=d._default(g,"cssFrom"),l=d._default(g,"cssTo"),k&&l&&(g.cssOnScroll=m);if(c.length>1)return c.each(function(c){for(var h,i,g=[],j=null,k=0;k<e.length;k++)h=e[k],i={},b.extend(i,h),g.push(i);f&&(j="self"===f?f:f.length>1&&c<f.length?b(f[c]):f),d.addItem(a+"-"+c,b(this),g,j)}),!0;var o=d._default(d.scrollLayout,a);return o?o.rules.concat(e):d.scrollLayout[a]={element:c,container:f,rules:e},!0},d.factory=function(a,b,c,e){return d.init(),a.length&&b?(e=e||a[0].tagName+"_"+d.getScrollLayoutLength(),void d.addItem(e,a,b,c,!1)):!1},d.stickItem=function(a,b,c){d.stickItemXY(a,b,c instanceof Array?c:[c])},d.stickItemXY=function(a,c,e){e=e||[];var g,h,i,j,k,l,m,n,f=[];for(var o in e)g=e[o],h=d._default(g,"$bottomContainer",b("body")),i=d._default(g,"mode"),j=d._default(g,"offsetTop",0),k=d._default(g,"offsetBottom",0),l=d._default(g,"minWidth",0),m=d._default(g,"maxWidth","infinity"),n=d._default(g,"static",!1),"next"===h?(i=i||"margin",h=b(c).next()):"parent"!==h&&h||(i=i||"padding",h=b(c).parent()),n?f.push({source:"sticky",alias:"static",minWidth:l,maxWidth:m,bottomContainer:h}):(f.push({source:"sticky",alias:"top",minWidth:l,maxWidth:m,offsetTop:j,offsetBottom:k,bottomContainer:h,mode:i}),f.push({source:"sticky",alias:"fixed",minWidth:l,maxWidth:m,offsetTop:j,offsetBottom:k,bottomContainer:h,mode:i}),f.push({source:"sticky",alias:"bottom",minWidth:l,maxWidth:m,offsetTop:j,offsetBottom:k,bottomContainer:h,mode:i}));d.addItem(a,b(c),f)},d.processStickyItemRange=function(a,c){c=c||{};var e=d._default(c,"bottomContainer",b("body")),g=(d._default(c,"mode"),d._default(c,"offsetTop",0)),h=d._default(c,"offsetBottom",0),i=parseInt(a.css("margin-top"))+a.height()+parseInt(a.css("margin-bottom"));"border-box"===a.css("box-sizing")&&(i+=parseInt(a.css("padding-top"))+parseInt(a.css("padding-bottom")));var j=parseInt(e.css("margin-top"))+e.height()+parseInt(e.css("margin-bottom"));"border-box"===e.css("box-sizing")&&(j+=parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom")));var k=Math.round(a.offset().top-parseInt(a.css("margin-top"))),l=Math.round(e.offset().top+(j-i-h));switch(c.alias){case"top":c.from=0,c.to=k-g,c.css={position:"absolute",top:k+"px"},c.itemHeight=i;break;case"fixed":c.from=k-g,c.to=l,c.css={position:"fixed",top:g+"px"},c.itemHeight=i;break;case"bottom":c.from=l,c.css={position:"absolute",top:l+g+"px"},c.itemHeight=i;break;case"static":c.from=0,c.css={position:"",top:""},c.itemHeight=0}return c},d.onResize=function(){d.winHeight=b(window).height(),d.docHeight=d.body.height(),d.docMiddle=Math.floor(d.docHeight/2);var a=!1;for(var c in d.scrollLayout){var f,g,h,e=d.scrollLayout[c];for(var i in e.rules)f=e.rules[i],g=d.isRuleInActiveWidthRange(f),a|=g,g&&void 0===f.from&&(b(e.element).css("position",""),b(e.element).css("top",""),f.bottomContainer&&f.bottomContainer.css("margin-top",""),h=d._default(f,"source"),"sticky"===h&&(e.rules[i]=d.processStickyItemRange(e.element,f)))}return a&&(d.scrollLayout=d.scrollLayout,setTimeout(function(){d.onScroll(!0)},0)),!0},d.getProgress=function(a,b){var c=a/b;return{offset:a,length:b,relative:c,left:b-a,leftRelative:1-c}},d.getTransitionFloatValue=function(a,b,c){return 0>=c?a:c>=1?b:a+(b-a)*c},d.getTransitionIntValue=function(a,b,c){return Math.round(d.getTransitionFloatValue(a,b,c))},d.hashColor2rgb=function(a){var b=a.match(/^#([0-9a-f]{3})$/i);return b?[17*parseInt(b[1].charAt(0),16),17*parseInt(b[1].charAt(1),16),17*parseInt(b[1].charAt(2),16)]:(b=a.match(/^#([0-9a-f]{6})$/i))?[parseInt(b[1].substr(0,2),16),parseInt(b[1].substr(2,2),16),parseInt(b[1].substr(4,2),16)]:[0,0,0]},d.rgb2HashColor=function(a,b,c){var e,f,d="#";for(var g in arguments)e=arguments[g],f=e.toString(16),16>e&&(f="0"+f),d+=f;return d},d.getTransitionColorValue=function(a,b,c){if(0>=c)return a;if(c>=1)return b;var e=d.hashColor2rgb(a),f=d.hashColor2rgb(b),g=d.getTransitionIntValue(e[0],f[0],c),h=d.getTransitionIntValue(e[1],f[1],c),i=d.getTransitionIntValue(e[2],f[2],c);return d.rgb2HashColor(g,h,i)},d.getTransitionValue=function(a,b,c){if(0>=c)return a;if(c>=1)return b;var e=0;if(d._isNumber(a)&&d._isNumber(b))return d.getTransitionFloatValue(a,a,c);var f=/(\d*\.\d+)|(\d+)|(#[0-9a-f]{6})|(#[0-9a-f]{3})/gi,g=(""+b).match(f);return(""+a).replace(f,function(a,b,f,h,i){var j=g[e];return e++,f&&f.length?/\d*\.\d+/.test(j)?d.getTransitionFloatValue(parseFloat(a),parseFloat(j),c):d.getTransitionIntValue(parseInt(a),parseInt(j),c):b&&b.length?d.getTransitionFloatValue(parseFloat(a),parseFloat(j),c):h&&h.length||i&&i.length?d.getTransitionColorValue(a,j,c):a})},d.onScroll=function(a){var b=d.body.scrollTop();if(!a&&b===d.scrollTop)return!1;var c=d.scrollTop,e=d.direction;d.scrollTop=b,d.scrollBottom=b+d.winHeight,d.scrollCenter=b+Math.floor(d.winHeight/2),d.direction=b-c;var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,f=!(d.direction===e||d.direction<0&&0>e||d.direction>0&&e>0);for(l in d.scrollLayout){for(g=d.scrollLayout[l],h=g.rules.length,i=[],j=[],k=[],m=0;h>m;m++)p=g.rules[m],q=d._default(p,"minWidth",0),r=d._default(p,"maxWidth","infinity"),s="self"===g.container?g.element:g.container,p.checkin=d.isRuleActive(p,g.element,s),p["class"]=p["class"]||"scroll-pos-"+p.alias+" window-width-"+q+"-to-"+r,p.checkin?(k.push(m),p.isActive||(p.isActive=!0,i.push(m))):p.isActive&&(p.isActive=!1,j.push(m)),g.rules[m]=p;for(o=0;o<j.length;o++)m=j[o],p=g.rules[m],g.element.removeClass(p["class"]),p.cssOnScroll&&(n=p.length||0,p.cssOnScroll(g.element,b>c?n:0,n,p)),p.onScroll&&(n=p.length||0,p.onScroll(g.element,b>c?n:0,n,p)),p.onCheckOut&&p.onCheckOut(g.element,p),p.onTopOut&&c>b?p.onTopOut(g.element,p):p.onBottomOut&&b>c&&p.onBottomOut(g.element,p);for(o=0;o<i.length;o++)m=i[o],p=g.rules[m],p.css&&g.element.css(d.extendCssWithPrefix(p.css)),p.addClass&&g.element.addClass(p.addClass),p.removeClass&&g.element.removeClass(p.removeClass),g.element.addClass(p["class"]),t=d._default(p,"bottomContainer"),u=d._default(p,"mode"),v=d._default(p,"itemHeight"),t&&u&&v&&t.css(u+"-top",v+"px"),p.onCheckIn&&p.onCheckIn(g.element,p),p.onTopIn&&b>c?p.onTopIn(g.element,p):p.onBottomIn&&c>b&&p.onBottomIn(g.element,p),p.length=p.checkin.length;for(o=0;o<k.length;o++)m=k[o],p=g.rules[m],p.cssOnScroll&&p.cssOnScroll(g.element,p.checkin.offset,p.checkin.length,p),p.onScroll&&p.onScroll(g.element,p.checkin.offset,p.checkin.length,p),f&&p.onDirectionChanged&&p.onDirectionChanged(g.element,d.direction,p);d.scrollLayout[l]=g}},d.detectCSSPrefix=function(){var a=/^(?:O|Moz|webkit|ms)|(?:-(?:o|moz|webkit|ms)-)/;if(window.getComputedStyle){var b=window.getComputedStyle(document.body,null);for(var c in b)if(d.theCSSPrefix=c.match(a)||+c===c&&b[c].match(a),d.theCSSPrefix)break;if(!d.theCSSPrefix)return void(d.theCSSPrefix=d.theDashedCSSPrefix="");d.theCSSPrefix=d.theCSSPrefix[0],"-"===d.theCSSPrefix.slice(0,1)?(d.theDashedCSSPrefix=d.theCSSPrefix,d.theCSSPrefix={"-webkit-":"webkit","-moz-":"Moz","-ms-":"ms","-o-":"O"}[d.theCSSPrefix]):d.theDashedCSSPrefix="-"+d.theCSSPrefix.toLowerCase()+"-"}},d.cssPrefix=function(a){return d.theDashedCSSPrefix+a},d.extendCssWithPrefix=function(a){var e,f,g,h,i,c={};for(e in a)f=/^-(moz-|webkit-|o-|ms-)?/i,g=e.match(f),h=e.slice(1),g&&!g[1]&&(i=a[e],c[h]=i,c[d.cssPrefix(h)]=i,delete a[e]);return b.extend(a,c),a},d.now=Date.now||function(){return+new Date},d.getRAF=function(){var a=window.requestAnimationFrame||window[d.theCSSPrefix.toLowerCase()+"RequestAnimationFrame"],b=d.now();return a||(a=function(a){var c=d.now()-b,e=Math.max(0,1e3/60-c);return window.setTimeout(function(){b=d.now(),a()},e)}),a},d.getCAF=function(){var a=window.cancelAnimationFrame||window[d.theCSSPrefix.toLowerCase()+"CancelAnimationFrame"];return(d.isMobile||!a)&&(a=function(a){return window.clearTimeout(a)}),a},d.animLoop=function(){d.onScroll(),d.animFrame=window.requestAnimFrame(d.animLoop)},d.init=function(a){return d.isInitialized?!1:(b.extend(d.options,a),d.isMobile=d._default(d.options,"isMobile",/Android|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent||navigator.vendor||window.opera)),d.detectCSSPrefix(),d.body=b(d.options.body),window.requestAnimFrame=d.getRAF(),window.cancelAnimFrame=d.getCAF(),d.timesCalled=0,b(document).ready(function(){b(window).resize(d.onResize).resize(),d.animLoop()}),void(d.isInitialized=!0))},d.destroy=function(){window.cancelAnimFrame(d.animFrame)},d.factorySticky=function(a,b,c){return c=c||a[0].tagName+"_"+d.getScrollLayoutLength(),d.stickItemXY(c,a,b instanceof Array?b:[b])?c:!1},c&&(b.scroolly=d,b.fn.scroolly=function(a,b,c){return d.factory(this,a,b,c),this},b.fn.scroollySticky=function(a,b){return d.init(),this.length?d.factorySticky(this,a,b):!1}),d});